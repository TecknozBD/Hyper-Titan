# **AXI DMA – Design Documentation**

**Author:** Amit Sikder  
**Developed At:** Tecknoz  
**License:** MIT  
**Protocol:** AMBA AXI4 / AXI4-Lite (via PULP AXI)

## **1\. Overview**

The AXI DMA Wrapper is a parameterized hardware integration module that connects a DMA engine to an AXI-based System-on-Chip (SoC) using the PULP AXI struct-based interface methodology.  
It functions as a protocol adaptation layer between the SoC interconnect and the internal DMA core, without altering the DMA core’s internal control or data-movement logic.

The wrapper exposes **two independent AXI interfaces**:

* A **full AXI4 slave interface** for DMA control and status register access  
* A **full AXI4 master interface** for DMA-initiated memory transactions

Control and status accesses are received as AXI4 transactions and are internally converted into **AXI4-Lite** transactions using a dedicated AXI-to-AXI-Lite bridge. This guarantees single-beat, ordered register accesses and prevents unsupported AXI features from reaching the DMA register block.

The data path operates as a full AXI4 master, forwarding DMA-generated read and write transactions without modification.  
Interrupt outputs provide explicit notification of DMA completion and error conditions.

The wrapper uses **type-parameterized AXI request and response structures**, allowing reuse across SoCs with different AXI widths and interconnect configurations without RTL changes.

## **2\. Architecture Overview**

The AXI DMA Wrapper comprises **three logical blocks**, each with a well-defined responsibility and no implicit coupling.

### **2.1 Control Plane (AXI CSR Path)**

* Terminates a full AXI4 slave interface from the SoC  
* Converts AXI4 CSR accesses to AXI4-Lite  
* Provides deterministic access to DMA control and status registers  
* Enforces AXI-Lite semantics: single-beat, ordered, non-bursting

This path is strictly used for configuration and status and never participates in data movement.

### **2.2 Data Plane (AXI DMA Master Path)**

* Exposes a full AXI4 master interface  
* Issues read and write transactions to system memory  
* Handles descriptor fetches and payload data transfers  
* Preserves all AXI attributes, including burst length, IDs, and response codes

The wrapper does not introduce buffering, reordering, or arbitration on this path.

### **2.3 DMA Core Interface**

* Delivers AXI-Lite CSR transactions to the DMA control logic  
* Forwards AXI master transactions generated by the DMA engine  
* Routes DMA completion and error indications to interrupt outputs

## **3\. External Interfaces**

All interfaces are synchronous to a single clock domain (`clk`).

### **3.1 Clock and Reset**

| Signal | Direction | Description |
| :---- | :---- | :---- |
| `clk` | Input | System clock for all CSR and DMA operations |
| `rst_n` | Input | Active-low synchronous reset |

During reset:

* No AXI transactions are accepted or generated  
* DMA state machines are reset  
* Interrupt outputs are deasserted

### **3.2 AXI CSR Interface (Slave)**

| Signal | Direction | Type | Description |
| :---- | :---- | :---- | :---- |
| **`mp_req_i`** | Input | **`mp_req_t`** | AXI4 slave request for CSR access |
| **`mp_resp_o`** | Output | **`mp_resp_t`** | AXI4 slave response |

Characteristics:

* Accepts full AXI4 transactions  
* Internally converted to AXI4-Lite  
* Used exclusively for control and status registers  
* Returns standard AXI responses (`OKAY`, `SLVERR`, `DECERR`)

### **3.3 AXI DMA Master Interface**

| Signal | Direction | Type | Description |
| :---- | :---- | :---- | :---- |
| `sp_req_o` | Output | `sp_req_t` | AXI4 master request generated by DMA |
| `sp_resp_i` | Input | `sp_resp_t` | AXI4 master response from interconnect |

Supported channels:

* AW, W, B, AR, R  
* All AXI attributes are preserved end-to-end.

### **3.4 Interrupt Outputs**

| Signal | Direction | Description |
| :---- | :---- | :---- |
| `dma_done_o` | Output | Asserted on successful DMA completion |
| `dma_error_o` | Output | Asserted on DMA or AXI error |

Interrupts are level-based and cleared via CSR writes.

## **4\. AXI-Lite CSR Path**

The AXI-Lite CSR path provides a **deterministic, single-beat register access mechanism** for configuring and monitoring the DMA engine.  
This path strictly separates **software-driven control operations** from **high-throughput DMA data movement**, ensuring that register accesses do not interfere with ongoing memory transactions.

All CSR accesses are ultimately performed using **AXI4-Lite semantics**, regardless of the capabilities of the SoC interconnect.

### 

### **4.1 AXI to AXI-Lite Conversion**

The wrapper instantiates a dedicated **AXI4-to-AXI4-Lite converter that bridges the SoC-facing AXI CSR interface (**mp\_req\_i/ `mp_resp_o`) to the DMA register block.

The converter terminates the **full AXI4 slave interface** exposed to the SoC and produces an **AXI4-Lite master interface** that drives the DMA CSRs.

This conversion is:

* Fully contained within the wrapper  
* Transparent to both the software and the DMA core  
* Independent of the data path

#### **Conversion Responsibilities**

The AXI-to-AXI-Lite converter enforces the following behaviors:

**Outstanding Transaction Control**  
CSR accesses are limited to a small, bounded number of in-flight transactions. This ensures that software observes deterministic ordering and completion behavior when accessing registers such as `dma_control` and `dma_status`.

**Burst Removal**  
Any burst-based AXI4 CSR access is converted into one or more **single-beat AXI-Lite transactions**.  
This guarantees that registers such as:

* `dma_control` (`0x00`)  
* `dma_desc_src_addr[n]` (`0x20`, `0x28`)  
* `dma_desc_cfg[n]` (`0x50`, `0x58`)

are accessed atomically and predictably.

**AXI ID Handling and Ordering**  
AXI ID reuse is removed on the CSR path.  
All register accesses are strictly ordered, ensuring correct sequencing when software performs multi-register programming sequences (for example, configuring descriptors before asserting `dma_control.go`).

**Protocol Enforcement**  
All generated transactions comply with AXI4-Lite timing and handshake rules. No AXI4-only features propagate beyond the converter.

**Response Preservation**  
AXI response codes (`OKAY`, `SLVERR`, `DECERR`) are preserved and returned on the AXI4 slave interface without modification.  
Error responses generated by invalid CSR accesses are visible to software and may also propagate to error status registers.

No buffering, shadow registers, or speculative accesses are introduced by the wrapper.

### **4.2 AXI-Lite Request and Response Structures**

The AXI-Lite interfaces generated by the converter are defined using **PULP AXI macros**:

\`AXI\_LITE\_TYPEDEF\_REQ\_T (axil\_req\_t,  axi\_lite\_aw\_t, axi\_lite\_w\_t, axi\_lite\_ar\_t)  
\`AXI\_LITE\_TYPEDEF\_RESP\_T(axil\_resp\_t, axi\_lite\_b\_t,  axi\_lite\_r\_t)

These macros define structured AXI-Lite channel groupings.

**AXI-Lite Request (`axil_req_t`)**

* Write Address (AW)  
* Write Data (W)  
* Read Address (AR)  
* Explicit, `valid,` and `ready` handshaking

**AXI-Lite Response (`axil_resp_t`)**

* Write Response (B)  
* Read Data (R)  
* Explicit, `valid,` and `ready` handshaking

Using structured types ensures that all CSR-related signals are explicitly connected and that ownership of each signal is unambiguous.

### **4.3 CSR Signal Mapping**

The wrapper performs a **direct, one-to-one combinational mapping** between:

* AXI-Lite request and response structures  
* DMA CSR MOSI/MISO interfaces consumed by the DMA core

#### **Mapping Characteristics**

* Each AXI-Lite channel signal maps directly to a corresponding DMA CSR signal.  
* No additional logic, buffering, arbitration, or sequencing is introduced.  
* All mappings are purely combinational and free of feedback paths.

This guarantees:

* **No combinational loops**  
* **Strict unidirectional request/response flow**  
* **End-to-end AXI-Lite semantic preservation**

Because the mapping is purely structural, changes to the CSR set (for example, adding new descriptor registers) do not require changes to the wrapper’s protocol logic.

## **5\. AXI DMA Data Path**

The AXI DMA Data Path handles **all memory transactions initiated by the DMA engine**.  
It exposes a **full AXI4 master interface** to the SoC interconnect and is entirely independent of the CSR control path.

No control-plane signals, arbitration logic, or protocol state are shared between the CSR and data paths.

### **5.1 AXI Master Role and Scope**

Within the system, the wrapper operates as an **AXI4 master** on behalf of the DMA core.

All AXI transactions on this interface are generated exclusively by the DMA engine as a result of software configuration through CSRs such as:

* `dma_desc_src_addr[n]`  
* `dma_desc_dst_addr[n]`  
* `dma_desc_num_bytes[n]`  
* `dma_desc_cfg[n]`  
* `dma_control.go`

The wrapper does not generate AXI transactions autonomously and does not interpret descriptor semantics.

### **5.2 AXI Master Interface Signals**

| Signal Name | Direction | Type | Description |
| :---- | :---- | :---- | :---- |
| `sp_req_o` | Output | `sp_req_t` | AXI4 master request carrying DMA-generated read/write transactions |
| `sp_resp_i` | Input | `sp_resp_t` | AXI4 master response from the interconnect |

Both signals are synchronous to `clk` and inactive during reset.

### **5.3 Supported AXI Channels**

The wrapper forwards all mandatory AXI4 channels without modification:

**Write Address (AW)**  
Carries destination address and attributes derived from:

* `dma_desc_dst_addr[n]`  
* `dma_desc_cfg[n].write_mode`  
* `dma_control.max_burst`

**Write Data (W)**  
Carries payload data fetched from source memory.  
Includes byte strobes and `WLAST`.

**Write Response (B)**  
Returns completion status for write transactions.  
AXI errors on this channel contribute to:

* `dma_error_stats`  
* `dma_error_addr`  
* `dma_error_o`

**Read Address (AR)**  
Carries source address and attributes derived from:

* `dma_desc_src_addr[n]`  
* `dma_desc_cfg[n].read_mode`

**Read Data (R)**  
Carries payload data and response status back to the DMA core.

No AXI channels are synthesized, merged, or suppressed.

### **5.4 Transaction Handling and Flow Control**

All data-path transactions follow standard AXI rules:

* `valid`/`ready` handshaking on all channels  
* Backpressure propagates directly to the DMA core  
* Ordering is maintained using AXI transaction IDs

The wrapper does **not** impose restrictions on:

* Burst length (bounded by `dma_control.max_burst`)  
* Transfer size  
* Number of outstanding transactions

Any such constraints are enforced by the DMA core or the SoC interconnect.

### **5.5 Descriptor and Payload Transfers**

Descriptor and payload accesses share the same AXI master interface.

* Descriptor reads determine transfer parameters.  
* Payload reads and writes move actual data.  
* Descriptor enablement is controlled via `dma_desc_cfg[n].enable`.

The wrapper does not differentiate between descriptor and payload traffic at the protocol level.

### **5.6 AXI Attribute Preservation**

All AXI attributes generated by the DMA core are preserved end-to-end:

* Transaction IDs  
* Burst type and length  
* Transfer size  
* Protection, cache, QoS, and user signals

This allows the DMA engine to participate fully in system-level arbitration and ordering.

### **5.7 Error Propagation**

AXI error responses (`SLVERR`, `DECERR`) are forwarded directly to the DMA core.

On error:

* `dma_error_stats.error_trig` is asserted  
* `dma_error_stats.error_type` and `error_src` are updated  
* `dma_error_addr` captures the faulting address  
* `dma_error_o` interrupt is asserted

The wrapper does not retry, mask, or reinterpret AXI errors.

### **5.8 Reset Behavior**

During reset (`rst_n = 0`):

* No AXI master requests are issued  
* All `valid` signals are deasserted  
* Partial transactions are abandoned  
* DMA core AXI state is reset

Normal operation resumes only after reset deassertion and explicit software reconfiguration.

## **6\. CSR Register Map and Programming Model**

### **6.1 Address Map (256 bytes)**

| Register | Offset |
| :---- | :---- |
| `dma_control` | `0x00` |
| `dma_status` | `0x08` |
| `dma_error_addr` | `0x10` |
| `dma_error_stats` | `0x18` |
| `dma_desc_src_addr[0:1]` | `0x20`, `0x28` |
| `dma_desc_dst_addr[0:1]` | `0x30`, `0x38` |
| `dma_desc_num_bytes[0:1]` | `0x40`, `0x48` |
| `dma_desc_cfg[0:1]` | `0x50`, `0x58` |

### **6.2 Key Registers**

**`dma_control` (0x00)**

* `go` \[0\]: Start DMA  
* `abort` \[1\]: Abort DMA  
* `max_burst` \[9:2\]: AXI burst length

**`dma_status` (0x08)**

* `version` \[15:0\] \= `0xCAFE`  
* `done` \[16\]  
* `error` \[17\]

**Descriptor Registers**  
Each descriptor defines:

* Source address  
* Destination address  
* Transfer size  
* Read/write mode  
* Enable bit

**6.3 Programming Sequence**

1. Configure descriptor registers  
2. Enable descriptors  
3. Program `max_burst`  
4. Set `dma_control.go`  
5. Poll `dma_status.done` or wait for interrupt  
6. On error, read `dma_error_stats` and `dma_error_addr`

## **7\. Interrupt, Reset, and Error Handling**

* `dma_done_o` asserted on successful completion  
* `dma_error_o` asserted on protocol or internal errors  
* Error details available via CSR registers  
* No automatic retry or recovery  
* Software-controlled error handling

Reset guarantees:

* No spurious AXI transactions  
* No partial transfers  
* No spurious interrupts

## **8\. Parameterization, Verification, and Compliance**

### **Parameterization**

* Type-based AXI interfaces (`mp_req_t`, `sp_req_t`, etc.)  
* Configurable AXI widths and attributes  
* Optional fixed DMA AXI ID (`DMA_ID_VAL`)

### **Verification**

* Compatible with UVM AXI agents  
* Struct-based monitoring  
* Supports directed, random, and error-injection testing

### **Compliance**

* AMBA AXI4 compliant (data path)  
* AMBA AXI4-Lite compliant (CSR path)  
* Protocol-clean and deterministic behavior

## **9\. Summary**

The **AXI DMA Wrapper** is a structured integration module that connects a DMA engine to an AXI-based System-on-Chip using **PULP AXI struct-based interfaces**.  
Its primary function is to provide a clear and deterministic boundary between software-controlled configuration logic and hardware-driven data movement, without introducing protocol ambiguity or hidden behavior.

The wrapper achieves this by exposing two independent AXI interfaces:

* A **full AXI4 slave interface** dedicated to control and status register access  
* A **full AXI4 master interface** used exclusively for DMA-initiated memory transactions

Control-path traffic is explicitly converted from AXI4 to AXI4-Lite using a dedicated protocol bridge. This guarantees single-beat, ordered register accesses and prevents unsupported AXI features from reaching the DMA register block. The conversion logic is fully contained within the wrapper and does not affect the data path.

The data path forwards AXI4 master transactions generated by the DMA core without modification. All AXI attributes, including burst information, transaction IDs, and response codes, are preserved end-to-end. The wrapper does not introduce buffering, arbitration, or reordering, ensuring transparent interaction with the SoC interconnect.